+++
title = "BAD BASS: Phishing through Webview Injection"
date = "2022-09-11T00:00:00Z"
categories = ["cplusplus", "golang", "malware"]
tags = ["cplusplus", "golang", "malware"]
+++

{{< toc >}}

# Introduction to Banking Malware

Zeus, SpyEye, and other banking malware of the pre-ransomware age have interested me since their discovery due to their ability to modify the web-content in browser processes through the clever utilization of API hooks. This allows these types of malware to not only capture credentials (which could be accomplished through a keylogger) but solicit additional information (such as social security numbers) that could prove useful for future fraudulent activity. Even beyond that, these trojans can potentially even obscure the evidence of their theft through rewriting the HTML content shown to the victim. The malware operator may have used the victim's bank account to wire money to a mule, but the balance will appear as if nothing had changed in the browser.


# Advances in Defense/Offense

With greater adoption of multi-factor authentication, EDRs, and better detection of process injection and hooking, the approach of those banking trojans has become less effective. That is not to say they cannot work, but they would need additional development in order to maintain stealth and operate in an account with MFA enabled.


Other approaches include using built-in functionality of browsers such as the Chromium-based [remote debugger port CLI flag](https://posts.specterops.io/hands-in-the-cookie-jar-dumping-cookies-with-chromiums-remote-debugger-port-34c4f468844e) , [malicious browser extensions](https://www.zscaler.com/blogs/security-research/malicious-chrome-extension-steals-cookies-and-credentials-bank-customers) , or simply [decrypting the encrypted cookies on disk](https://www.ired.team/offensive-security/credential-access-and-credential-dumping/reading-dpapi-encrypted-secrets-with-mimikatz-and-c++). Those come with their own pros and cons. With the former, no files need to be dropped to disk, and no memory injection is required. However, [high-cardinality detections already exist](https://www.elastic.co/guide/en/security/current/potential-cookies-theft-via-browser-debugging.html) that can alert on that type of attack since that behavior is highly unusual for most machines. With the second, no process injection is required either, but files have to be dropped to disk which may increase the risk of detection. *None have the same raw ability of banking trojans to inject web-content into the user's browser, however*.


# BAD BASS: What it (Does/Does Not) Do

**BAD BASS** is a proof-of-concept for an experiment in injecting a webview into Chromium-based browsers in order to phish for credentials and solicit additional information that could prove useful for its operator. 

In its current form, it **does not defeat MFA**. A small amount of work would be required in order to integrate it with something like [Evilginx2](https://github.com/kgretzky/evilginx2) that could make this possible. Dynamic, remote web-inject configuration would be required in order to make this work. A downside to MITM tools like Evilginx2 is the need of using a phishing domain that could alert a sufficiently aware user. Combining the injected webview with evilginx2 would allow a MFA-aware MITM attack without alerting the user through a suspicious domain the URL box. 

Additionally, in its current form, there are several huge IOCs that will be discussed that could tip off a defender of its presence. More work will be required (that will also be discussed) in order to make this a viable technique.